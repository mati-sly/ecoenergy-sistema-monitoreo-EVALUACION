<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <title>Resumen de Alertas - EcoEnergy</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #87ceeb 0%,
          #e0f6ff 50%,
          #98fb98 100%
        );
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        padding: 30px;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 2px solid rgba(135, 206, 235, 0.3);
      }

      h1 {
        color: #2f5f8f;
        font-size: 2.2em;
        font-weight: 300;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 10px;
      }

      .severity-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .severity-card {
        background: rgba(255, 255, 255, 0.8);
        border-radius: 15px;
        padding: 20px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      }

      .severity-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        padding: 10px;
        border-radius: 10px;
      }

      .severity-grave {
        background: rgba(244, 67, 54, 0.1);
      }
      .severity-alto {
        background: rgba(255, 152, 0, 0.1);
      }
      .severity-mediano {
        background: rgba(255, 235, 59, 0.1);
      }

      .severity-grave h3 {
        color: #f44336;
      }
      .severity-alto h3 {
        color: #ff9800;
      }
      .severity-mediano h3 {
        color: #ffc107;
      }

      .severity-count {
        font-size: 2em;
        font-weight: bold;
        margin-left: auto;
      }

      .alert-list {
        margin-top: 15px;
      }

      .alert-item {
        background: rgba(255, 255, 255, 0.7);
        margin-bottom: 10px;
        padding: 12px;
        border-radius: 8px;
        border-left: 4px solid;
      }

      .alert-item.grave {
        border-left-color: #f44336;
      }
      .alert-item.alto {
        border-left-color: #ff9800;
      }
      .alert-item.mediano {
        border-left-color: #ffc107;
      }

      .alert-device {
        font-weight: 600;
        color: #2f5f8f;
        margin-bottom: 5px;
      }

      .alert-message {
        font-size: 0.9em;
        color: #666;
        margin-bottom: 5px;
      }

      .alert-date {
        font-size: 0.8em;
        color: #999;
      }

      .recent-alerts {
        margin-top: 30px;
      }

      .recent-alerts h2 {
        color: #2f5f8f;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .recent-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
      }

      .recent-table thead {
        background: linear-gradient(135deg, #2f5f8f, #1e3d5f);
      }

      .recent-table th {
        color: white;
        padding: 15px;
        text-align: left;
        font-weight: 500;
      }

      .recent-table th:first-child {
        border-top-left-radius: 10px;
      }
      .recent-table th:last-child {
        border-top-right-radius: 10px;
      }

      .recent-table tbody tr {
        border-bottom: 1px solid rgba(135, 206, 235, 0.2);
        transition: all 0.3s ease;
      }

      .recent-table tbody tr:hover {
        background: rgba(135, 206, 235, 0.1);
      }

      .recent-table td {
        padding: 12px 15px;
        color: #333;
      }

      .severity-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: 500;
        color: white;
      }

      .badge-grave {
        background: #f44336;
      }
      .badge-alto {
        background: #ff9800;
      }
      .badge-mediano {
        background: #ffc107;
        color: #333;
      }

      .device-link {
        color: #2f5f8f;
        text-decoration: none;
        font-weight: 500;
      }

      .device-link:hover {
        text-decoration: underline;
      }

      .back-link {
        text-align: center;
        margin-top: 30px;
      }

      .btn-back {
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: white;
        padding: 12px 24px;
        text-decoration: none;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .btn-back:hover {
        transform: translateY(-2px);
        text-decoration: none;
        color: white;
      }

      .empty-state {
        text-align: center;
        color: #666;
        font-style: italic;
        padding: 40px;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 15px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>Resumen de Alertas de la Semana</h1>
        <p>Prioriza la revisi√≥n de incidentes por severidad</p>
      </div>

      <!-- Alertas por severidad -->
      <div class="severity-grid">
        <div class="severity-card">
          <div class="severity-header severity-grave">
            <h3>Alertas Graves</h3>
            <div class="severity-count">
              {{ alerts_by_severity.Grave|length|default:0 }}
            </div>
          </div>
          {% if alerts_by_severity.Grave %}
          <div class="alert-list">
            {% for alert in alerts_by_severity.Grave|slice:":5" %}
            <div class="alert-item grave">
              <div class="alert-device">{{ alert.device.name }}</div>
              <div class="alert-message">
                {{ alert.message|truncatewords:10 }}
              </div>
              <div class="alert-date">
                {{ alert.alert_date|date:"d/m/Y H:i" }}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state" style="padding: 20px">
            No hay alertas graves esta semana
          </div>
          {% endif %}
        </div>

        <div class="severity-card">
          <div class="severity-header severity-alto">
            <h3>Alertas Alto</h3>
            <div class="severity-count">
              {{ alerts_by_severity.Alto|length|default:0 }}
            </div>
          </div>
          {% if alerts_by_severity.Alto %}
          <div class="alert-list">
            {% for alert in alerts_by_severity.Alto|slice:":5" %}
            <div class="alert-item alto">
              <div class="alert-device">{{ alert.device.name }}</div>
              <div class="alert-message">
                {{ alert.message|truncatewords:10 }}
              </div>
              <div class="alert-date">
                {{ alert.alert_date|date:"d/m/Y H:i" }}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state" style="padding: 20px">
            No hay alertas altas esta semana
          </div>
          {% endif %}
        </div>

        <div class="severity-card">
          <div class="severity-header severity-mediano">
            <h3>Alertas Mediano</h3>
            <div class="severity-count">
              {{ alerts_by_severity.Mediano|length|default:0 }}
            </div>
          </div>
          {% if alerts_by_severity.Mediano %}
          <div class="alert-list">
            {% for alert in alerts_by_severity.Mediano|slice:":5" %}
            <div class="alert-item mediano">
              <div class="alert-device">{{ alert.device.name }}</div>
              <div class="alert-message">
                {{ alert.message|truncatewords:10 }}
              </div>
              <div class="alert-date">
                {{ alert.alert_date|date:"d/m/Y H:i" }}
              </div>
            </div>
            {% endfor %}
          </div>
          {% else %}
          <div class="empty-state" style="padding: 20px">
            No hay alertas medianas esta semana
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Lista de alertas recientes -->
      <div class="recent-alerts">
        <h2>Alertas Recientes</h2>
        {% if recent_alerts %}
        <table class="recent-table">
          <thead>
            <tr>
              <th>Dispositivo</th>
              <th>Tipo</th>
              <th>Severidad</th>
              <th>Mensaje</th>
              <th>Fecha</th>
            </tr>
          </thead>
          <tbody>
            {% for alert in recent_alerts %}
            <tr>
              <td>
                <a
                  href="{% url 'device_detail' alert.device.id %}"
                  class="device-link"
                >
                  {{ alert.device.name }}
                </a>
              </td>
              <td>{{ alert.get_alert_type_display }}</td>
              <td>
                <span class="severity-badge badge-{{ alert.severity|lower }}">
                  {{ alert.severity }}
                </span>
              </td>
              <td>{{ alert.message|truncatewords:8 }}</td>
              <td>{{ alert.alert_date|date:"d/m/Y H:i" }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div class="empty-state">No hay alertas recientes disponibles</div>
        {% endif %}
      </div>

      <div class="back-link">
        <a href="{% url 'dashboard' %}" class="btn-back">Volver al Dashboard</a>
      </div>
    </div>
  </body>
</html>
